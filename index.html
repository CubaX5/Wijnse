<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Wijn Smaakspel ‚Äì Druif, Stijl & Regio</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#0b0b10;color:#f5f5f7}
  .wrap{max-width:900px;margin:auto;padding:16px 16px 120px}
  .card{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.45)}
  .top{display:flex;gap:10px;align-items:center;margin:8px 0 12px}
  .badge{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);font-weight:800;white-space:nowrap}
  .progress{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid rgba(255,255,255,.12)}
  .progress div{height:100%;width:0%;background:linear-gradient(90deg,#7c3aed,#ec4899);transition:.3s}
  h1{font-size:18px;margin:0 0 10px}
  .item{font-size:26px;font-weight:900;margin:2px 0 10px}
  .options{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:700px){.options{grid-template-columns:1fr 1fr}}
  .opt{padding:14px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.25);cursor:pointer;font-weight:800;line-height:1.25}
  .opt.selected{background:rgba(236,72,153,.2);border-color:rgba(236,72,153,.65)}
  .feedback{margin-top:12px;padding:12px 14px;border-radius:14px;display:none;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.06);line-height:1.35}
  .feedback.good{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.45)}
  .feedback.bad{background:rgba(239,68,68,.16);border-color:rgba(239,68,68,.45)}
  .hint{opacity:.85;font-size:13px;margin-top:6px}
  .bottom{position:fixed;left:0;right:0;bottom:0;background:rgba(11,11,16,.85);border-top:1px solid rgba(255,255,255,.12);backdrop-filter:blur(10px);padding:12px 16px calc(12px + env(safe-area-inset-bottom, 0px))}
  .bottom .inner{max-width:900px;margin:auto;display:flex;gap:10px}
  button{flex:1;padding:14px;border-radius:14px;border:0;font-weight:900}
  .primary{background:linear-gradient(90deg,#22c55e,#a3e635);color:#0b0b10}
  .secondary{background:rgba(255,255,255,.08);color:#f5f5f7;border:1px solid rgba(255,255,255,.12)}
  button:disabled{opacity:.4}
  .error{margin-top:12px;padding:12px 14px;border-radius:14px;border:1px solid rgba(239,68,68,.45);background:rgba(239,68,68,.16);display:none}
  code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="badge">üç∑ Wijnspel</div>
    <div class="progress" aria-label="Voortgang"><div id="bar"></div></div>
    <div class="badge">‚≠ê <span id="score">0</span></div>
  </div>

  <div class="card">
    <h1>Kies exact <b>3 smaakprofielen</b></h1>
    <div class="item" id="item">‚Ä¶</div>

    <noscript>
      <div class="error" style="display:block">
        JavaScript staat uit of wordt niet uitgevoerd. Open dit bestand in <b>Safari</b> (niet in een preview) en zorg dat JavaScript aan staat.
      </div>
    </noscript>

    <div class="options" id="options"></div>
    <div class="feedback" id="feedback"></div>
    <div class="error" id="errbox"></div>
    <div class="hint">
      Tip: Als je op iPhone g√©√©n opties ziet, open het bestand via <b>Delen ‚Üí Open in Safari</b> (de Files/Preview-viewer draait vaak geen scripts).
    </div>
  </div>
</div>

<div class="bottom">
  <div class="inner">
    <button class="secondary" id="reset" type="button">Reset</button>
    <button class="primary" id="check" type="button" disabled>Check</button>
    <button class="secondary" id="next" type="button" disabled>Volgende</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const errbox = document.getElementById("errbox");
  const showError = (msg, err) => {
    errbox.style.display = "block";
    errbox.innerHTML = "<b>Er ging iets mis.</b><br>" +
      msg + (err ? "<br><br><code>" + String(err).replaceAll("<","&lt;") + "</code>" : "");
  };

  try {
    const items = [
      {n:"Gew√ºrztraminer",c:["Exotisch fruit","Bloemig & kruidig","Laag zuur / aromatisch"]},
      {n:"Sauvignon Blanc",c:["Fris & groen","Aromatisch","Hoge zuren"]},
      {n:"Riesling",c:["Citrus & steenfruit","Mineraal/bloemig","Droog tot zoet"]},
      {n:"Syrah",c:["Donker fruit","Peperig & rokerig","Krachtig"]},
      {n:"Chablis",c:["Strak & mineraal","Citrus","Hoge zuren"]},
      {n:"Chardonnay (hout)",c:["Boter & vanille","Rijp geel fruit","Vol & romig"]},
      {n:"Muscadet",c:["Zilt & mineraal","Zeer fris","Licht body"]},
      {n:"Rioja Crianza/Reserva",c:["Rood fruit","Vanille & hout","Zacht kruidig"]},
      {n:"Rh√¥ne (blend)",c:["Rijp rood fruit","Kruidig","Medium tot vol"]},
      {n:"Carmen√®re",c:["Donker fruit","Kruidig","Groene paprika"]},
      {n:"Pinot Noir Bourgogne",c:["Rood fruit","Aards","Elegant & fris"]},
      {n:"Bardolino / Valpolicella",c:["Licht rood fruit","Sappig","Weinig tannine"]},
    ];

    const all = Array.from(new Set(items.flatMap(i => i.c)));

    let cur = null;
    let sel = new Set();
    let score = 0;
    let round = 0;

    const itemEl = document.getElementById("item");
    const optEl  = document.getElementById("options");
    const fb     = document.getElementById("feedback");
    const bar    = document.getElementById("bar");
    const check  = document.getElementById("check");
    const next   = document.getElementById("next");
    const reset  = document.getElementById("reset");
    const scoreEl= document.getElementById("score");

    const haptic = (ms=15) => { try { if (navigator.vibrate) navigator.vibrate(ms); } catch(e){} };

    const shuffle = (arr) => {
      const a = arr.slice();
      for (let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    };

    function render(){
      sel.clear();
      fb.style.display = "none";
      fb.className = "feedback";
      check.disabled = true;
      next.disabled = true;

      cur = items[Math.floor(Math.random()*items.length)];
      itemEl.textContent = cur.n;

      const distract = all.filter(x => !cur.c.includes(x));
      const opts = shuffle(cur.c.concat(shuffle(distract).slice(0,3)));

      optEl.innerHTML = "";
      opts.forEach(o => {
        const d = document.createElement("div");
        d.className = "opt";
        d.textContent = o;
        d.addEventListener("click", () => {
          if (fb.style.display === "block") return; // locked after check
          if (sel.has(o)){
            sel.delete(o);
            d.classList.remove("selected");
            haptic(10);
          } else {
            if (sel.size >= 3) { haptic(25); return; }
            sel.add(o);
            d.classList.add("selected");
            haptic(12);
          }
          check.disabled = (sel.size !== 3);
        });
        optEl.appendChild(d);
      });

      bar.style.width = Math.round((round / Math.max(items.length,1)) * 100) + "%";
    }

    check.addEventListener("click", () => {
      const good = Array.from(sel).filter(x => cur.c.includes(x)).length;
      fb.className = "feedback " + (good === 3 ? "good" : "bad");
      fb.innerHTML = (good === 3)
        ? "‚úÖ Helemaal goed!"
        : "‚ö° Bijna. Juiste profielen:<br>" + cur.c.join(" ‚Ä¢ ");
      fb.style.display = "block";

      score += good * 3;
      scoreEl.textContent = score;

      next.disabled = false;
      check.disabled = true;
      haptic(good === 3 ? 30 : 20);
    });

    next.addEventListener("click", () => {
      round += 1;
      render();
    });

    reset.addEventListener("click", () => {
      round = round; // keep progress
      render();
    });

    // First render
    render();

  } catch (e) {
    showError("De game-script is gecrasht. Dit gebeurt vaak als het bestand in een preview-viewer opent i.p.v. Safari.", e);
  }
});
</script>
</body>
</html>
